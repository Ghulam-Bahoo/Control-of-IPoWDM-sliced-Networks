version: "3.8"

services:
  # IPoWDM Controller with shared topics
  ipowdm-controller:
    build:
      context: .
      dockerfile: Dockerfile.controller
    image: ipowdm-controller:latest
    container_name: ipowdm-controller
    network_mode: host
    environment:
      - KAFKA_BROKER=10.30.7.52:9092
      - CONTROLLER_ID=paper-controller-v1
      - CONFIG_TOPIC=config-topic
      - MONITORING_TOPIC=monitoring-topic
    restart: unless-stopped

  # AKHQ for Kafka UI
  akhq:
    image: tchiotludo/akhq:latest
    container_name: akhq
    network_mode: host
    environment:
      AKHQ_CONFIGURATION: |
        akhq:
          connections:
            kafka:
              properties:
                bootstrap.servers: "10.30.7.52:9092"
    restart: unless-stopped
